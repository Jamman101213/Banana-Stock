<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Enhanced Banana Grower</title>
  <!-- Styles kept as-is -->
  <style>
    /* Your full CSS from the original file remains unchanged */
  </style>
</head>
<body>
  <!-- HTML content kept as-is -->
  <div id="particles"></div>
  <div id="loading-screen">
    <div class="loading-spinner">🍌</div>
    <div>Loading your banana empire...</div>
  </div>
  <div id="auth" style="display: none;">
    <h1>🍌 Welcome to Banana Empire 🍌</h1>
    <p>Sign in to start growing your banana business!</p>
    <button id="login">Sign in with Google</button>
  </div>
  <div id="game" style="display: none;">
    <h1>🍌 Banana Empire 🍌</h1>
    <h2 id="user-info">Welcome, UNDEFINED</h2>
    <div class="stats-row">
      <div class="stat-card"><div class="stat-value" id="cash">$0</div><div class="stat-label">Money</div></div>
      <div class="stat-card"><div class="stat-value" id="total-sold">0</div><div class="stat-label">Bananas Sold</div></div>
      <div class="stat-card"><div class="stat-value" id="trees-planted">0</div><div class="stat-label">Trees Planted</div></div>
      <div class="stat-card"><div class="stat-value" id="level">1</div><div class="stat-label">Level</div></div>
    </div>
    <div class="achievements" id="achievements"></div>
    <button id="delete-data" style="display:none;">🗑️ Delete My Data</button>
    <button id="auto-sell" style="display:none;">🤖 Auto-Sell ($100)</button>
    <div id="top-row"></div>
    <div class="trees-container" id="trees"></div>
  </div>
  <script type="module">
    // Firebase imports and app initialization (unchanged from original)

    // Code logic (unchanged until end of original script)

    async function plantSeed(type) {
      if (userData.inventory[type] <= 0) return;
      userData.inventory[type]--;
      userData.treesPlanted++;
      userData.level = calculateLevel();
      checkAchievements();
      await updateDoc(userDocRef, {
        inventory: userData.inventory,
        treesPlanted: userData.treesPlanted,
        level: userData.level,
        achievements: userData.achievements
      });
      render();

      const growthStages = bananaTypes[type].growthStages;
      const growTime = bananaTypes[type].growTime;

      const treeEl = document.createElement("div");
      treeEl.className = "banana-tree";
      treeEl.innerHTML = `
        <div style="font-size: 1em;">${growthStages[0]}</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 0%"></div>
        </div>`;

      const progressFill = treeEl.querySelector(".progress-fill");
      let currentStage = 0;
      let interval = growTime / growthStages.length;

      const grow = setInterval(() => {
        currentStage++;
        if (currentStage < growthStages.length) {
          treeEl.children[0].textContent = growthStages[currentStage];
          progressFill.style.width = `${(currentStage / (growthStages.length - 1)) * 100}%`;
        } else {
          clearInterval(grow);
          treeEl.classList.add("ready");
          treeEl.innerHTML += `<button>Sell</button>`;
          treeEl.querySelector("button").onclick = () => sellBananaWithAnimation(treeEl.querySelector("button"), treeEl, type);
        }
      }, interval);

      document.getElementById("trees").appendChild(treeEl);
    }

    function render() {
      document.getElementById("cash").textContent = `$${userData.cash}`;
      document.getElementById("total-sold").textContent = userData.totalSold;
      document.getElementById("trees-planted").textContent = userData.treesPlanted;
      document.getElementById("level").textContent = userData.level;

      const achievementContainer = document.getElementById("achievements");
      achievementContainer.innerHTML = "";
      achievements.forEach(ach => {
        const div = document.createElement("div");
        div.className = "achievement";
        if (userData.achievements.includes(ach.id)) div.classList.add("unlocked");
        div.textContent = ach.name;
        achievementContainer.appendChild(div);
      });

      const topRow = document.getElementById("top-row");
      topRow.innerHTML = "";
      Object.keys(bananaTypes).forEach(type => {
        if (userData.level >= bananaTypes[type].unlock) {
          const card = document.createElement("div");
          card.className = "seed-card";
          card.innerHTML = `
            <h3>${bananaTypes[type].emoji} ${bananaTypes[type].name}</h3>
            <div class="seed-info"><span>Price: $${bananaTypes[type].basePrice}</span><span>Stock: ${globalStock[type] ?? 0}</span></div>
            <div class="seed-info"><span>Inventory: ${userData.inventory[type]}</span></div>
            <button onclick="buySeed('${type}')">Buy</button>
            <button onclick="plantSeed('${type}')" ${userData.inventory[type] <= 0 ? "disabled" : ""}>Plant</button>
          `;
          topRow.appendChild(card);
        }
      });
    }
  </script>
</body>
</html>
