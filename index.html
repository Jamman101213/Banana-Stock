<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Banana Grower with Growth Animation</title>
  <style>
    body {
      background: #fefae0;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
    }

    h1 {
      color: #665c00;
    }

    #top-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .seed-card {
      background: #fff9c4;
      border: 2px solid #ffecb3;
      border-radius: 10px;
      padding: 15px;
      width: 160px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .seed-card h3 {
      margin: 5px 0;
      color: #a18800;
    }

    .seed-card button {
      margin: 5px 5px 0 5px;
      padding: 5px 10px;
      border: none;
      background: #ffd54f;
      color: #5d4037;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s ease;
    }

    .seed-card button:hover {
      background: #ffe082;
    }

    .banana-tree {
      margin: 10px auto;
      padding: 15px;
      background: #e0f7fa;
      border: 2px solid #b2ebf2;
      border-radius: 10px;
      width: 300px;
      position: relative;
      transition: all 0.3s ease-in-out;
      font-weight: bold;
      color: #00796b;
      font-size: 2em;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .banana-tree button {
      margin-top: 10px;
      background: #b2dfdb;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s ease;
      font-size: 0.6em;
      user-select: none;
    }

    .banana-tree button:hover {
      background: #a5d6a7;
    }

    #cash {
      font-weight: bold;
      font-size: 1.8em;
      color: green;
      display: inline-block;
      position: relative;
      min-width: 50px;
    }

    .fly-banana {
      position: fixed;
      font-size: 2em;
      z-index: 1000;
      pointer-events: none;
      user-select: none;
    }
  </style>
</head>
<body>
  <h1>üçå Banana Grower</h1>
  <div id="auth">
    <button id="login">Sign in with Google</button>
  </div>

  <div id="game" style="display:none;">
    <h2 id="user-info"></h2>
    <h3>Money: $<span id="cash">0</span></h3>
    <div id="top-row"></div>
    <div id="trees"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAiNsBnqgY2i1aLzyJEC0YcwDoGJTGYLiM",
      authDomain: "websites-be0b4.firebaseapp.com",
      projectId: "websites-be0b4",
      storageBucket: "websites-be0b4.appspot.com",
      messagingSenderId: "1027369012808",
      appId: "1:1027369012808:web:3d7ed70ba0234ada62d27d"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Store growth stages as strings: emojis or base64 image data URLs
    const bananaTypes = {
      common: { 
        name: "Common", 
        growTime: 4000, 
        basePrice: 5, 
        growthStages: [
          "üå±", 
          "üåø", 
          // banana tree image base64 string as data URL
          "data:image/png;base64,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"
        ],
        harvestPrice: 50,
        growthAnimationDuration: 2000
      },
      rare: {
        name: "Rare",
        growTime: 7000,
        basePrice: 20,
        growthStages: [
          "üå±", 
          "üåø", 
          "üå≥"
        ],
        harvestPrice: 200,
        growthAnimationDuration: 3000
      }
    };

    let cash = 0;
    const cashElement = document.getElementById('cash');
    const topRow = document.getElementById('top-row');
    const treesDiv = document.getElementById('trees');
    const authDiv = document.getElementById('auth');
    const gameDiv = document.getElementById('game');
    const loginBtn = document.getElementById('login');
    const userInfo = document.getElementById('user-info');

    // Google login handler
    loginBtn.addEventListener('click', () => {
      const provider = new GoogleAuthProvider();
      signInWithPopup(auth, provider).catch(console.error);
    });

    let currentUser;

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        authDiv.style.display = 'none';
        gameDiv.style.display = 'block';
        userInfo.textContent = `Welcome, ${user.displayName}`;
        await loadUserData();
        renderSeeds();
        renderTrees();
        updateCashDisplay();
      } else {
        authDiv.style.display = 'block';
        gameDiv.style.display = 'none';
      }
    });

    // User data from Firestore
    let userData = {
      cash: 0,
      seeds: {
        common: 1,
        rare: 0
      },
      trees: [] // array of {type, plantedAt, stage}
    };

    async function loadUserData() {
      const docRef = doc(db, "bananaGrowerUsers", currentUser.uid);
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        userData = docSnap.data();
      } else {
        await setDoc(docRef, userData);
      }
      cash = userData.cash || 0;
    }

    async function saveUserData() {
      if (!currentUser) return;
      const docRef = doc(db, "bananaGrowerUsers", currentUser.uid);
      userData.cash = cash;
      await setDoc(docRef, userData);
    }

    function updateCashDisplay() {
      cashElement.textContent = cash;
    }

    function renderSeeds() {
      topRow.innerHTML = '';
      Object.keys(userData.seeds).forEach(type => {
        const count = userData.seeds[type];
        const seedInfo = bananaTypes[type];
        const card = document.createElement('div');
        card.className = 'seed-card';

        card.innerHTML = `
          <h3>${seedInfo.name} Seeds</h3>
          <p>Count: ${count}</p>
          <button id="buy-${type}">Buy ($${seedInfo.basePrice})</button>
          <button id="plant-${type}" ${count === 0 ? 'disabled' : ''}>Plant</button>
        `;
        topRow.appendChild(card);

        card.querySelector(`#buy-${type}`).addEventListener('click', () => {
          if (cash >= seedInfo.basePrice) {
            cash -= seedInfo.basePrice;
            userData.seeds[type]++;
            updateCashDisplay();
            saveUserData();
            renderSeeds();
          } else {
            alert('Not enough money to buy seed!');
          }
        });

        card.querySelector(`#plant-${type}`).addEventListener('click', () => {
          if (userData.seeds[type] > 0) {
            userData.seeds[type]--;
            plantTree(type);
            renderSeeds();
            saveUserData();
          }
        });
      });
    }

    function plantTree(type) {
      const newTree = {
        type,
        plantedAt: Date.now(),
        stage: 0
      };
      userData.trees.push(newTree);
      renderTrees();
      saveUserData();
    }

    function renderTrees() {
      treesDiv.innerHTML = '';
      userData.trees.forEach((tree, idx) => {
        const treeInfo = bananaTypes[tree.type];
        const div = document.createElement('div');
        div.className = 'banana-tree';

        // Determine current growth stage based on elapsed time
        const elapsed = Date.now() - tree.plantedAt;
        const totalGrowTime = treeInfo.growTime;
        const stageCount = treeInfo.growthStages.length;

        // Calculate stage index (0 to stageCount-1)
        let currentStageIndex = Math.min(stageCount - 1, Math.floor(elapsed / (totalGrowTime / stageCount)));

        // Update stage in userData for save
        userData.trees[idx].stage = currentStageIndex;

        // Get stage image or emoji string
        const stageContent = treeInfo.growthStages[currentStageIndex];

        // Create image or emoji
        let stageElement;
        if (stageContent.startsWith('data:image')) {
          stageElement = document.createElement('img');
          stageElement.src = stageContent;
          stageElement.style.width = '120px';
          stageElement.style.height = 'auto';
          stageElement.style.userSelect = 'none';
        } else {
          stageElement = document.createElement('div');
          stageElement.textContent = stageContent;
          stageElement.style.fontSize = '3em';
          stageElement.style.userSelect = 'none';
        }

        div.appendChild(stageElement);

        // Show harvest button only if fully grown
        if (currentStageIndex === stageCount - 1) {
          const btn = document.createElement('button');
          btn.textContent = `Harvest $${treeInfo.harvestPrice}`;
          btn.addEventListener('click', () => harvestTree(idx));
          div.appendChild(btn);
        } else {
          const timeLeft = Math.max(0, totalGrowTime - elapsed);
          const secLeft = Math.ceil(timeLeft / 1000);
          const info = document.createElement('div');
          info.textContent = `Growing... (${secLeft}s left)`;
          info.style.fontSize = '0.8em';
          info.style.color = '#555';
          div.appendChild(info);
        }

        treesDiv.appendChild(div);
      });
      saveUserData();
    }

    function harvestTree(idx) {
      const tree = userData.trees[idx];
      const treeInfo = bananaTypes[tree.type];
      cash += treeInfo.harvestPrice;
      userData.trees.splice(idx, 1);
      updateCashDisplay();
      renderTrees();
      saveUserData();
    }

    // Periodically update growth stages every second
    setInterval(() => {
      if (currentUser) {
        renderTrees();
      }
    }, 1000);
  </script>
</body>
</html>
