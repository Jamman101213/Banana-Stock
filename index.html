<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Banana Grower Deluxe</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #fefae0 0%, #f4f1c9 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated background elements */
    .bg-banana {
      position: fixed;
      font-size: 2em;
      opacity: 0.1;
      animation: float 6s ease-in-out infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(10deg); }
    }

    /* Loading screen styles */
    #loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, #fefae0 0%, #f4f1c9 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 2em;
      font-weight: bold;
      color: #665c00;
      z-index: 9999;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #ffecb3;
      border-top: 4px solid #ffd54f;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    h1 {
      color: #665c00;
      font-size: 3em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 10px;
      animation: pulse 2s ease-in-out infinite alternate;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      100% { transform: scale(1.05); }
    }

    .stats-container {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .stat-card {
      background: linear-gradient(145deg, #fff9c4, #f0f0f0);
      border: 2px solid #ffecb3;
      border-radius: 15px;
      padding: 15px 25px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      min-width: 120px;
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-value {
      font-size: 1.5em;
      font-weight: bold;
      color: #2e7d32;
    }

    .stat-label {
      font-size: 0.9em;
      color: #666;
      margin-top: 5px;
    }

    #top-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px auto;
      max-width: 1000px;
    }

    .seed-card {
      background: linear-gradient(145deg, #fff9c4, #f5f5dc);
      border: 2px solid #ffecb3;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .seed-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }

    .seed-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      transition: left 0.5s;
    }

    .seed-card:hover::before {
      left: 100%;
    }

    .seed-card h3 {
      margin: 5px 0 15px 0;
      color: #a18800;
      font-size: 1.3em;
    }

    .seed-info {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      font-size: 0.9em;
    }

    .seed-card button {
      margin: 8px 5px;
      padding: 10px 15px;
      border: none;
      background: linear-gradient(145deg, #ffd54f, #ffb300);
      color: #5d4037;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.9em;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .seed-card button:hover:not(:disabled) {
      background: linear-gradient(145deg, #ffe082, #ffc107);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .seed-card button:disabled {
      background: #ccc;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4caf50, #8bc34a);
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 4px;
    }

    .banana-tree {
      margin: 15px;
      padding: 20px;
      background: linear-gradient(145deg, #e0f7fa, #b2ebf2);
      border: 3px solid #4dd0e1;
      border-radius: 15px;
      width: 280px;
      position: relative;
      transition: all 0.3s ease-in-out;
      font-weight: bold;
      color: #00796b;
      font-size: 2em;
      user-select: none;
      display: inline-block;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }

    .banana-tree:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }

    .banana-tree.ready {
      animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      0% { box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
      100% { box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3); }
    }

    .banana-tree button {
      margin-top: 15px;
      background: linear-gradient(145deg, #66bb6a, #4caf50);
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      font-size: 0.6em;
      user-select: none;
      color: white;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    }

    .banana-tree button:hover {
      background: linear-gradient(145deg, #81c784, #66bb6a);
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }

    .trees-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 30px;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    .fly-banana {
      position: fixed;
      font-size: 2em;
      z-index: 1000;
      pointer-events: none;
      user-select: none;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
    }

    .cash-animation {
      animation: cashPulse 0.5s ease-out;
    }

    @keyframes cashPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); color: #4caf50; }
      100% { transform: scale(1); }
    }

    #delete-data {
      background: linear-gradient(145deg, #ff5252, #f44336);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 20px 10px;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    }

    #delete-data:hover {
      background: linear-gradient(145deg, #ff3030, #d32f2f);
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }

    .auth-container {
      background: rgba(255, 255, 255, 0.9);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      max-width: 400px;
      margin: auto;
    }

    #login {
      background: linear-gradient(145deg, #4285f4, #3367d6);
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    #login:hover {
      background: linear-gradient(145deg, #5a95f5, #4285f4);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    .achievement {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(145deg, #ffd700, #ffb300);
      color: #5d4037;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      font-weight: bold;
      z-index: 1001;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      0% { transform: translateX(100%); }
      100% { transform: translateX(0); }
    }

    .rarity-normal { border-left: 4px solid #4caf50; }
    .rarity-big { border-left: 4px solid #2196f3; }
    .rarity-rainbow { border-left: 4px solid #9c27b0; }
    .rarity-mythical { border-left: 4px solid #ff9800; }

    @media (max-width: 768px) {
      .stats-container {
        gap: 15px;
      }
      
      .stat-card {
        padding: 10px 15px;
        min-width: 100px;
      }
      
      .banana-tree {
        width: 240px;
        margin: 10px;
      }
      
      h1 {
        font-size: 2.5em;
      }
    }
  </style>
</head>
<body>
  <!-- Animated background bananas -->
  <div class="bg-banana" style="top: 10%; left: 5%; animation-delay: 0s;">üçå</div>
  <div class="bg-banana" style="top: 20%; right: 10%; animation-delay: 1s;">üçå</div>
  <div class="bg-banana" style="bottom: 15%; left: 15%; animation-delay: 2s;">üçå</div>
  <div class="bg-banana" style="bottom: 25%; right: 5%; animation-delay: 3s;">üçå</div>

  <!-- Loading screen -->
  <div id="loading-screen">
    <div class="loading-spinner"></div>
    <div>Loading Banana Empire...</div>
  </div>

  <h1>üçå Banana Grower Deluxe</h1>

  <div id="auth" style="display: none;">
    <div class="auth-container">
      <h2>Welcome to Banana Empire!</h2>
      <p>Sign in to start growing your banana fortune</p>
      <button id="login">üöÄ Sign in with Google</button>
    </div>
  </div>

  <div id="game" style="display: none;">
    <h2 id="user-info">Welcome, UNDEFINED</h2>
    
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-value" id="cash">UNDEFINED</div>
        <div class="stat-label">üí∞ Money</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="trees-planted">0</div>
        <div class="stat-label">üå± Trees Planted</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="bananas-sold">0</div>
        <div class="stat-label">üçå Bananas Sold</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="total-profit">$0</div>
        <div class="stat-label">üìà Total Profit</div>
      </div>
    </div>

    <button id="delete-data" style="display:none;">üóëÔ∏è Delete My Data</button>
    
    <div id="top-row"></div>
    <div class="trees-container" id="trees"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAiNsBnqgY2i1aLzyJEC0YcwDoGJTGYLiM",
      authDomain: "websites-be0b4.firebaseapp.com",
      projectId: "websites-be0b4",
      storageBucket: "websites-be0b4.appspot.com",
      messagingSenderId: "1027369012808",
      appId: "1:1027369012808:web:3d7ed70ba0234ada62d27d"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const bananaTypes = {
      normal: { 
        name: "Normal", 
        growTime: 3000, 
        basePrice: 5, 
        emoji: "üçå",
        growthStages: ["üå±", "ü™¥", "üå≥"],
        rarity: "normal"
      },
      big: { 
        name: "Big", 
        growTime: 6000, 
        basePrice: 12, 
        emoji: "üçåüçå",
        growthStages: ["üå±", "ü™¥", "üå≥"],
        rarity: "big"
      },
      rainbow: { 
        name: "Rainbow", 
        growTime: 10000, 
        basePrice: 30, 
        emoji: "üåàüçå",
        growthStages: ["üå±", "ü™¥", "üå≥"],
        rarity: "rainbow"
      },
      mythical: { 
        name: "Mythical", 
        growTime: 15000, 
        basePrice: 75, 
        emoji: "‚ú®üçå‚ú®",
        growthStages: ["üå±", "ü™¥", "üå≥"],
        rarity: "mythical"
      },
      golden: { 
        name: "Golden", 
        growTime: 25000, 
        basePrice: 150, 
        emoji: "üèÜüçåüèÜ",
        growthStages: ["üå±", "ü™¥", "üå≥"],
        rarity: "mythical"
      }
    };

    let userDocRef, userData, globalStock = {};
    let treesPlanted = 0, bananasSold = 0, totalProfit = 0;
    const stockDocRef = doc(db, "bananaStock", "current");

    // Show login button if user not logged in
    document.getElementById('login').onclick = () => {
      const provider = new GoogleAuthProvider();
      signInWithPopup(auth, provider);
    };

    function showLoadingScreen(show) {
      const loading = document.getElementById('loading-screen');
      loading.style.display = show ? 'flex' : 'none';
    }

    function showAchievement(text) {
      const achievement = document.createElement('div');
      achievement.className = 'achievement';
      achievement.innerHTML = `üèÜ ${text}`;
      document.body.appendChild(achievement);
      
      setTimeout(() => {
        achievement.style.animation = 'slideIn 0.5s ease-out reverse';
        setTimeout(() => achievement.remove(), 500);
      }, 3000);
    }

    function checkAchievements() {
      if (treesPlanted === 1) showAchievement("First Tree Planted!");
      if (treesPlanted === 10) showAchievement("Green Thumb - 10 Trees!");
      if (bananasSold === 1) showAchievement("First Sale!");
      if (bananasSold === 50) showAchievement("Banana Merchant - 50 Sales!");
      if (userData.cash >= 1000) showAchievement("Banana Millionaire!");
      if (totalProfit >= 500) showAchievement("Profit Master - $500!");
    }

    async function loadUserData(user) {
      userDocRef = doc(db, "bananaUsers", user.uid);
      const docSnap = await getDoc(userDocRef);

      if (docSnap.exists()) {
        userData = docSnap.data();
        treesPlanted = userData.treesPlanted || 0;
        bananasSold = userData.bananasSold || 0;
        totalProfit = userData.totalProfit || 0;
      } else {
        userData = {
          cash: 20,
          inventory: {
            normal: 2,
            big: 0,
            rainbow: 0,
            mythical: 0,
            golden: 0
          },
          treesPlanted: 0,
          bananasSold: 0,
          totalProfit: 0
        };
        await setDoc(userDocRef, userData);
      }

      const stockSnap = await getDoc(stockDocRef);
      if (!stockSnap.exists()) {
        globalStock = {
          normal: 100,
          big: 50,
          rainbow: 25,
          mythical: 10,
          golden: 3
        };
        await setDoc(stockDocRef, globalStock);
      } else {
        globalStock = stockSnap.data();
      }
    }

    onAuthStateChanged(auth, async user => {
      if (!user) {
        showLoadingScreen(false);
        document.getElementById('auth').style.display = 'block';
        document.getElementById('game').style.display = 'none';
        return;
      }

      showLoadingScreen(true);
      await loadUserData(user);
      
      onSnapshot(stockDocRef, (docSnap) => {
        if (docSnap.exists()) {
          globalStock = docSnap.data();
          render();
        }
      });

      document.getElementById('user-info').textContent = `Welcome back, ${user.displayName}! üëã`;
      document.getElementById('auth').style.display = 'none';
      document.getElementById('game').style.display = 'block';

      const deleteBtn = document.getElementById('delete-data');
      deleteBtn.style.display = 'inline-block';

      deleteBtn.onclick = async () => {
        if (confirm("‚ö†Ô∏è Are you sure you want to delete your banana empire? This cannot be undone!")) {
          try {
            await deleteDoc(userDocRef);
            alert("Your data was deleted. Starting fresh! üå±");
            location.reload();
          } catch (e) {
            alert("Error deleting data: " + e.message);
          }
        }
      };

      render();
      setTimeout(() => showLoadingScreen(false), 1500);
    });

    async function buySeed(type) {
      const cost = bananaTypes[type].basePrice;
      if (userData.cash >= cost && globalStock[type] > 0) {
        userData.cash -= cost;
        userData.inventory[type]++;
        globalStock[type]--;

        await Promise.all([
          updateDoc(userDocRef, {
            cash: userData.cash,
            inventory: userData.inventory
          }),
          updateDoc(stockDocRef, { [type]: globalStock[type] })
        ]);

        // Add purchase animation
        const cashEl = document.getElementById("cash");
        cashEl.classList.add('cash-animation');
        setTimeout(() => cashEl.classList.remove('cash-animation'), 500);

        render();
      } else if (userData.cash < cost) {
        alert("üí∏ Not enough money! Need $" + (cost - userData.cash) + " more.");
      } else {
        alert("üì¶ Out of stock! Check back later.");
      }
    }

    async function sellBananaWithAnimation(buttonEl, treeEl, type) {
      buttonEl.disabled = true;
      treeEl.classList.remove('ready');

      const cashCounter = document.getElementById("cash");
      const cashRect = cashCounter.getBoundingClientRect();
      const treeRect = treeEl.getBoundingClientRect();

      const baseProfit = bananaTypes[type].basePrice;
      const bonus = Math.floor(Math.random() * Math.max(1, baseProfit * 0.3));
      const profit = baseProfit + bonus;
      
      userData.cash += profit;
      bananasSold++;
      totalProfit += profit;
      userData.bananasSold = bananasSold;
      userData.totalProfit = totalProfit;

      await updateDoc(userDocRef, { 
        cash: userData.cash,
        bananasSold: userData.bananasSold,
        totalProfit: userData.totalProfit
      });

      checkAchievements();

      const startX = treeRect.left + treeRect.width / 2;
      const startY = treeRect.top + treeRect.height / 2;
      const endX = cashRect.left + cashRect.width / 2;
      const endY = cashRect.top + cashRect.height / 2;

      // Create more dynamic banana animation
      for (let i = 0; i < 15; i++) {
        const bananaIcon = document.createElement("div");
        bananaIcon.className = "fly-banana";
        bananaIcon.textContent = bananaTypes[type].emoji;
        bananaIcon.style.left = startX + (Math.random() * 50 - 25) + "px";
        bananaIcon.style.top = startY + (Math.random() * 50 - 25) + "px";
        document.body.appendChild(bananaIcon);

        const deltaX = endX - parseFloat(bananaIcon.style.left);
        const deltaY = endY - parseFloat(bananaIcon.style.top);

        bananaIcon.animate([
          { 
            transform: "translate(0, 0) rotate(0deg) scale(1)", 
            opacity: 1 
          },
          { 
            transform: `translate(${deltaX}px, ${deltaY}px) rotate(360deg) scale(0.3)`, 
            opacity: 0 
          }
        ], {
          duration: 1200 + Math.random() * 400,
          easing: "cubic-bezier(0.25, 0.46, 0.45, 0.94)",
          delay: i * 80
        }).onfinish = () => bananaIcon.remove();
      }

      // Add cash animation
      const cashEl = document.getElementById("cash");
      cashEl.classList.add('cash-animation');
      setTimeout(() => cashEl.classList.remove('cash-animation'), 500);

      setTimeout(() => {
        treeEl.remove();
        render();
      }, 2000);
    }

    async function plantSeed(type) {
      if (userData.inventory[type] <= 0) return;
      
      userData.inventory[type]--;
      treesPlanted++;
      userData.treesPlanted = treesPlanted;
      
      await updateDoc(userDocRef, { 
        inventory: userData.inventory,
        treesPlanted: userData.treesPlanted
      });
      
      checkAchievements();

      const growthStages = bananaTypes[type].growthStages;
      const growTime = bananaTypes[type].growTime;

      const treeEl = document.createElement("div");
      treeEl.className = `banana-tree rarity-${bananaTypes[type].rarity}`;
      treeEl.innerHTML = `
        <div>${growthStages[0]}</div>
        <div style="font-size: 0.4em; margin-top: 5px;">${bananaTypes[type].name}</div>
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
      `;
      document.getElementById("trees").appendChild(treeEl);

      const progressFill = treeEl.querySelector('.progress-fill');
      let stage = 0;
      let progress = 0;

      const growInterval = setInterval(() => {
        progress += 100 / (growthStages.length * 10);
        progressFill.style.width = Math.min(progress, 100) + '%';

        if (progress >= (stage + 1) * (100 / growthStages.length)) {
          stage++;
          if (stage >= growthStages.length) {
            clearInterval(growInterval);
            progressFill.style.width = '100%';
            
            treeEl.innerHTML = `
              <div>${bananaTypes[type].emoji} Ready!</div>
              <div style="font-size: 0.4em; margin-top: 5px;">Worth: $${bananaTypes[type].basePrice}+</div>
            `;
            treeEl.classList.add('ready');

            const sellBtn = document.createElement("button");
            sellBtn.textContent = "üí∞ Harvest";
            treeEl.appendChild(sellBtn);

            sellBtn.onclick = async () => {
              await sellBananaWithAnimation(sellBtn, treeEl, type);
            };
            return;
          }
          treeEl.querySelector('div').textContent = growthStages[stage];
        }
      }, growTime / (growthStages.length * 10));

      render();
    }

    function render() {
      document.getElementById("cash").textContent = "$" + userData.cash.toFixed(0);
      document.getElementById("trees-planted").textContent = treesPlanted;
      document.getElementById("bananas-sold").textContent = bananasSold;
      document.getElementById("total-profit").textContent = "$" + totalProfit;

      const topRow = document.getElementById("top-row");
      topRow.innerHTML = "";

      for (const type in bananaTypes) {
        const seed = bananaTypes[type];
        const inStock = globalStock[type] || 0;
        const owned = userData.inventory[type] || 0;
        
        const card = document.createElement("div");
        card.className = `seed-card rarity-${seed.rarity}`;
        card.innerHTML = `
          <h3>${seed.emoji} ${seed.name} Banana</h3>
          <div class="seed-info">
            <span><strong>Price:</strong> $${seed.basePrice}</span>
            <span><strong>Time:</strong> ${(seed.growTime/1000).toFixed(1)}s</span>
          </div>
          <div class="seed-info">
            <span><strong>Stock:</strong> ${inStock}</span>
            <span><strong>You have:</strong> ${owned}</span>
          </div>
          <div>
            <button id="buy-${type}" ${userData.cash < seed.basePrice || inStock <= 0 ? "disabled" : ""}>
              üí≥ Buy ($${seed.basePrice})
            </button>
            <button id="plant-${type}" ${owned <= 0 ? "disabled" : ""}>
              üå± Plant (${owned})
            </button>
          </div>
        `;

        topRow
